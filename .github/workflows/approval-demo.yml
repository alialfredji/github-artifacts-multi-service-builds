name: Approval Demo Workflow

on:
  push:
    branches: [ main ]
  workflow_dispatch:
    inputs:
      approval_token:
        description: 'Approval token (leave empty for initial run)'
        required: false
        type: string

jobs:
  step-1:
    runs-on: ubuntu-latest
    steps:
    - name: Step 1 - Initial Setup
      run: |
        echo "üöÄ Step 1: Initial setup completed"
        echo "Timestamp: $(date)"
        echo "Branch: ${{ github.ref_name }}"
        echo "Commit: ${{ github.sha }}"
        
  step-2:
    runs-on: ubuntu-latest
    needs: step-1
    steps:
    - name: Step 2 - Data Processing
      run: |
        echo "üìä Step 2: Data processing started"
        echo "Processing some data..."
        sleep 2
        echo "‚úÖ Step 2: Data processing completed"
        
  step-3-approval:
    runs-on: ubuntu-latest
    needs: step-2
    if: github.event.inputs.approval_token == ''
    steps:
    - name: Step 3 - Manual Approval Required
      run: |
        echo "‚è∏Ô∏è  Step 3: Manual approval required"
        echo "This step requires manual approval to continue"
        echo ""
        echo "To approve and continue:"
        echo "1. Go to Actions tab"
        echo "2. Click 'Run workflow' on this workflow"
        echo "3. Enter any value in 'approval_token' field"
        echo "4. Click 'Run workflow'"
        echo ""
        echo "Workflow will continue to steps 4 and 5 after approval."
        
    - name: Stop workflow waiting for approval
      run: |
        echo "‚è∏Ô∏è  Workflow paused - waiting for manual approval"
        echo "Please trigger the workflow manually with an approval_token to continue"
        exit 1
        
  step-4:
    runs-on: ubuntu-latest
    needs: step-2
    if: github.event.inputs.approval_token != ''
    steps:
    - name: Step 4 - Post-Approval Processing
      run: |
        echo "üéâ Step 4: Post-approval processing"
        echo "Approval was granted! Continuing with deployment..."
        echo "Running post-approval tasks..."
        sleep 3
        echo "‚úÖ Step 4: Post-approval processing completed"
        
  step-5:
    runs-on: ubuntu-latest
    needs: step-4
    if: github.event.inputs.approval_token != ''
    steps:
    - name: Step 5 - Final Deployment
      run: |
        echo "üöÄ Step 5: Final deployment"
        echo "All approvals received! Deploying to production..."
        echo "Simulating deployment process..."
        sleep 2
        echo "‚úÖ Step 5: Deployment completed successfully!"
        echo "üéâ All steps completed with manual approval!"
